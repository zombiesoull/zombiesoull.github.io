<!-- build time:Sun Mar 19 2023 17:38:53 GMT+0800 (中国标准时间) --><!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="JSON Schema,"><meta name="description" content="关于：JSON Schema的最佳实践和高级用法。JSON Schema最佳实践¶1.what is it ？NoteJSON Schema is a powerful tool for validating the structure of JSON data. However, learning to use it by reading its specification is like le"><meta property="og:type" content="article"><meta property="og:title" content="JSON Schema的最佳实践&amp;高级用法"><meta property="og:url" content="http://yoursite.com/2022/01/24/JSON%20Schema%E8%B0%83%E7%A0%94/index.html"><meta property="og:site_name" content="Zombiesoul Blog"><meta property="og:description" content="关于：JSON Schema的最佳实践和高级用法。JSON Schema最佳实践¶1.what is it ？NoteJSON Schema is a powerful tool for validating the structure of JSON data. However, learning to use it by reading its specification is like le"><meta property="og:image" content="https://raw.githubusercontent.com/zombiesoull/markdown_assets/master/img/image-20211220105521532-20230304200911470.png"><meta property="og:image" content="https://raw.githubusercontent.com/zombiesoull/markdown_assets/master/img/image-20211221104639187.png"><meta property="og:image" content="https://raw.githubusercontent.com/zombiesoull/markdown_assets/master/img/image-20211220105521532.png"><meta property="og:image" content="https://raw.githubusercontent.com/zombiesoull/markdown_assets/master/img/image-20211221174601044.png"><meta property="article:published_time" content="2022-01-24T06:54:08.000Z"><meta property="article:modified_time" content="2023-03-04T12:58:44.391Z"><meta property="article:author" content="Jin Zombie"><meta property="article:tag" content="JSON Schema"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://raw.githubusercontent.com/zombiesoull/markdown_assets/master/img/image-20211220105521532-20230304200911470.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/2022/01/24/JSON Schema调研/"><title>JSON Schema的最佳实践&高级用法 | Zombiesoul Blog</title><meta name="generator" content="Hexo 4.2.0"></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Zombiesoul Blog</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2022/01/24/JSON%20Schema%E8%B0%83%E7%A0%94/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Jin Zombie"><meta itemprop="description" content=""><meta itemprop="image" content="/images/logo.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Zombiesoul Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">JSON Schema的最佳实践&高级用法</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-01-24T14:54:08+08:00">2022-01-24 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JSON/" itemprop="url" rel="index"><span itemprop="name">JSON</span> </a></span></span><span class="post-meta-divider">|</span> <span class="page-pv">本站总阅读量 <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次</span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计&#58;</span> <span title="字数统计">1.7k </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">8</span></div></div></header><div class="post-body" itemprop="articleBody"><p>关于：JSON Schema的最佳实践和高级用法。</p><h1>JSON Schema最佳实践</h1><h2 id="1-what-is-it-？"><a class="header-anchor" href="#1-what-is-it-？">¶</a>1.what is it ？</h2><hr><ul><li><a href="https://json-schema.org/understanding-json-schema/index.html" target="_blank" rel="noopener">Note</a></li></ul><blockquote><p>JSON Schema is a powerful tool for validating the structure of JSON data. However, learning to use it by reading its specification is like learning to drive a car by looking at its blueprints. You don’t need to know how an electric motor fits together if all you want to do is pick up the groceries. This book, therefore, aims to be the friendly driving instructor for JSON Schema. It’s for those that want to write it and understand it, but maybe aren’t interested in building their own car—er, writing their own JSON Schema validator—just yet.</p><p>JSON Schema 是一个用于验证 JSON 数据结构的强力工具。然而，通过阅读说明书来学习使用它就像通过看图纸来学习开车一样。如果你只是去杂货店买东西，你不需要知道电动机是如何组合在一起的。因此，本书旨在成为 JSON 模式的友好操作指南。它是为那些想要编写并理解它，但可能对自己制造汽车不感兴趣的人准备的，比如，编写自己的 JSON 模式验证器。</p></blockquote><p>本文只大概介绍<code>JSON Schema</code>.后面会直接开始调研官方推荐的第三方校验库。故建议读者通过本文进行编码实践之前，最好先移步 <a href="https://json-schema.org/understanding-json-schema/index.html" target="_blank" rel="noopener">官网</a> 了解其语法 。</p><h2 id="2-有哪些第三方实现"><a class="header-anchor" href="#2-有哪些第三方实现">¶</a>2. 有哪些第三方实现</h2><hr><p>我在官方文档翻阅了关于<code>JSON Schema</code>推荐的实现，发现官网大方的列举了各个主流语言的大量第三方校验库。</p><p><img src="https://raw.githubusercontent.com/zombiesoull/markdown_assets/master/img/image-20211220105521532-20230304200911470.png" alt=""></p><p>当然，本文只关注Java / Python 语言的实现：</p><ul><li><p>Java</p><ul><li><p><a href="https://github.com/ssilverman/snowy-json" target="_blank" rel="noopener">Snow</a> <em>2019-09, draft-07, -06</em> Uses Maven for the project and Gson under the hood. (GNU Affero General Public License v3.0)</p></li><li><p><a href="https://github.com/eclipse-vertx/vertx-json-schema" target="_blank" rel="noopener">Vert.x Json Schema</a> <em>2019-09, draft-07</em> includes custom keywords support, custom dialect support, asynchronous validation (Apache License, Version 2.0)</p></li><li><p><a href="https://github.com/everit-org/json-schema" target="_blank" rel="noopener">everit-org/json-schema</a> <em>draft-07, -06, -04</em> (Apache License 2.0)</p></li><li><p><a href="https://github.com/leadpony/justify" target="_blank" rel="noopener">Justify</a> <em>draft-07, -06, -04</em> (Apache License 2.0)</p></li><li><p><a href="https://github.com/networknt/json-schema-validator" target="_blank" rel="noopener">networknt/json-schema-validator</a> <em>draft-07, -06, -04</em> Support OpenAPI 3.0 with Jackson parser (Apache License 2.0)</p></li><li><p><a href="https://github.com/java-json-tools/json-schema-validator" target="_blank" rel="noopener">jsonschemafriend</a> <em>2019-09, draft-07, -06, -04, -03</em> (Apache License 2.0)</p></li><li><p>然而，只从官网获取信息往往还不够。所以通过全网补充了市场上广泛应用的一个实现</p><p><a href="https://github.com/jimblackler/jsonschemafriend" target="_blank" rel="noopener">fge/json-schema-validator也称作 java-json-tools/json-schema-validator</a> <em>2019-09, draft-04, -03</em> (Apache License 2.0, LGPL)</p></li></ul></li><li><p>Python</p><ul><li><a href="https://github.com/marksparkza/jschon" target="_blank" rel="noopener">jschon</a> <em>2019-09, 2020-12</em> (MIT)</li><li><a href="https://github.com/Julian/jsonschema" target="_blank" rel="noopener">jsonschema</a> <em>2019-09, 2020-12, draft-07, -06, -04, -03</em> (MIT)</li><li><a href="https://github.com/horejsek/python-fastjsonschema" target="_blank" rel="noopener">fastjsonschema</a> <em>draft-07, -06, -04</em> Great performance thanks to code generation. (BSD-3-Clause)</li><li><a href="https://github.com/Stranger6667/jsonschema-rs/tree/master/bindings/python" target="_blank" rel="noopener">jsonschema-rs</a> <em>draft-07, -06, -04</em> Python bindings to Rust’s jsonschema crate (MIT)</li></ul></li></ul><h2 id="3-Java校验库选型"><a class="header-anchor" href="#3-Java校验库选型">¶</a>3. Java校验库选型</h2><hr><h3 id="1-挑选出合适的实现库"><a class="header-anchor" href="#1-挑选出合适的实现库">¶</a>1. 挑选出合适的实现库</h3><p>为了服务端对推理结果数据的校验。所以选用实现时，我从以下几点进行考虑：</p><ul><li>开源且被广泛应用</li><li>兼容JSON Schema 主流标准（当前版本是 Draft 7，但 Draft 4 仍然被广泛使用）</li><li>校验结果信息充分，有利于快速诊断非法的json格式（后面会基于见微3.x的推理数据和基础schema进行编码测试）</li><li>性能优良（后面会基于见微3.x的推理数据和基础schema进行编码测试；稳定迭代；）</li><li>兼容fastjson或jackson</li></ul><p>综上，我选取了两种<code>Json Schema</code>库：</p><table><thead><tr><th>库名称</th><th>地址</th><th>支持草案</th></tr></thead><tbody><tr><td>networknt</td><td><a href="https://github.com/networknt/json-schema-validator" target="_blank" rel="noopener">https://github.com/networknt/json-schema-validator</a></td><td>draft-07, -06, -04</td></tr><tr><td>fge</td><td><a href="https://github.com/java-json-tools/json-schema-validator" target="_blank" rel="noopener">https://github.com/java-json-tools/json-schema-validator</a></td><td>draft-04, 03</td></tr><tr><td>everit</td><td><a href="https://github.com/everit-org/json-schema" target="_blank" rel="noopener">https://github.com/everit-org/json-schema</a></td><td>draft-07, -06, -04</td></tr></tbody></table><h3 id="2-通过编码进行性能测试"><a class="header-anchor" href="#2-通过编码进行性能测试">¶</a>2. 通过编码进行性能测试</h3><p>networknt官方为了宣传其性能上的优势，专门提供了一个性能测试的项目。</p><blockquote><h4 id="Performance"><a class="header-anchor" href="#Performance">¶</a>Performance</h4><p>It is the fastest Java JSON Schema Validator as far as I know. Here is the testing result compare with the other two open-source implementations. It is about 32 times faster than the Fge and five times faster than the Everit.</p><p>fge: 7130ms<br>everit-org: 1168ms<br>networknt: 223ms</p></blockquote><p>我对其发布的性能统计有点存疑，所以基于<a href="https://github.com/networknt/json-schema-validator-perftest" target="_blank" rel="noopener">此项目</a> 修改为：基于算法侧输出的推理结果文件和基础schema模板进行三个实现库的性能测试，毕竟调研出适合自己的库才是真正意义上的最佳实践。</p><ul><li><p>完整代码见附件（暂不发布线上，有需要的同学可以基于<a href="https://github.com/networknt/json-schema-validator-perftest" target="_blank" rel="noopener">此项目</a>进行性能测试。）：</p><p>[json-schema-validator-zombie_perf_test.7z](JSON Schema调研.assets/json-schema-validator-zombie_perf_test.7z)</p></li><li><p>运行上面的代码，后进行性能统计：</p><p><img src="https://raw.githubusercontent.com/zombiesoull/markdown_assets/master/img/image-20211221104639187.png" alt="image-20211221104639187"></p></li><li><p>校验错误输出：</p><p><img src="https://raw.githubusercontent.com/zombiesoull/markdown_assets/master/img/image-20211220105521532.png" alt="image-20211220105521532"></p></li><li><p>三个校验库的依赖情况</p></li></ul><p><img src="https://raw.githubusercontent.com/zombiesoull/markdown_assets/master/img/image-20211221174601044.png" alt="image-20211221174601044"></p><h3 id="3-根据测试统计信息进行选择"><a class="header-anchor" href="#3-根据测试统计信息进行选择">¶</a>3. 根据测试统计信息进行选择</h3><ul><li><p>比对性能测试后的统计结果，明显可以pass掉依赖最多，处理最慢且兼容json schema官方草案版本最少的 fge库 了。</p></li><li><p>至于everit和networknt的取舍最终我分别看了下两个库依赖的jar（如上图所示），其中everit依赖了JSON官方提供的org.json，鉴于我的工程内已经存在了两个json库了（jackson库&amp;fastjson库），再引入第三个json库大可不必。</p></li><li><p>出于这一点不如使用处理速度最快，依赖最简洁（依赖jackson-bind库）的networknt。</p></li></ul><h3 id="4-安利一个根据json模板文件推理出JSON-schema的库"><a class="header-anchor" href="#4-安利一个根据json模板文件推理出JSON-schema的库">¶</a>4. 安利一个根据json模板文件推理出JSON schema的库</h3><p>我们通过它可以构建一个基础的JSON schema，然后再进一步修改获得更为严格的校验文件！</p><h4 id="（1）官方介绍"><a class="header-anchor" href="#（1）官方介绍">¶</a>（1）官方介绍</h4><p><a href="https://github.com/saasquatch/json-schema-inferrer" target="_blank" rel="noopener">json-schema-inferrer</a></p><blockquote><p>Java library for inferring JSON schema based on sample JSONs.<br>基于JSON案例推理JSON schema的 Java 库。</p></blockquote><h4 id="（2）编码实践"><a class="header-anchor" href="#（2）编码实践">¶</a>（2）编码实践</h4><ul><li>maven dependency</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- json-schema-inferrer --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.saasquatch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json-schema-inferrer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- json-schema-inferrer --&gt;</span></span><br></pre></td></tr></table></figure><ul><li>代码案例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.networknt.schema.perftest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.node.ObjectNode;</span><br><span class="line"><span class="keyword">import</span> com.saasquatch.jsonschemainferrer.SpecVersion;</span><br><span class="line"><span class="keyword">import</span> com.saasquatch.jsonschemainferrer.AdditionalPropertiesPolicies;</span><br><span class="line"><span class="keyword">import</span> com.saasquatch.jsonschemainferrer.JsonSchemaInferrer;</span><br><span class="line"><span class="keyword">import</span> com.saasquatch.jsonschemainferrer.RequiredPolicies;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonSchemaGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> JsonSchemaInferrer inferrer = JsonSchemaInferrer.newBuilder()</span><br><span class="line">            <span class="comment">//.setSpecVersion(SpecVersion.DRAFT_04)</span></span><br><span class="line">            .setSpecVersion(SpecVersion.DRAFT_07)</span><br><span class="line">            .setAdditionalPropertiesPolicy(AdditionalPropertiesPolicies.notAllowed())</span><br><span class="line">            .setRequiredPolicy(RequiredPolicies.nonNullCommonFields())</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... str)</span> <span class="keyword">throws</span> IOException, URISyntaxException </span>&#123;</span><br><span class="line">        String resultsFilePath = <span class="string">"/infer/det_12.jpg.json"</span>;</span><br><span class="line">        String inferJson = FileUtils.readFileToString(<span class="keyword">new</span> File(JsonSchemaGenerator<span class="class">.<span class="keyword">class</span>.<span class="title">getResource</span>(<span class="title">resultsFilePath</span>).<span class="title">toURI</span>()), <span class="title">Charset</span>.<span class="title">defaultCharset</span>())</span>;</span><br><span class="line">        ObjectNode inferForSample = inferrer.inferForSample(mapper.readTree(inferJson));</span><br><span class="line">        System.out.println(inferForSample.toPrettyString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>运行后输出json schema内容</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"$id"</span>: <span class="string">"http://zombie.com/schemas/test_task_infers_d7.json"</span>,</span><br><span class="line">  <span class="attr">"$schema"</span>: <span class="string">"http://json-schema.org/draft-07/schema#"</span>,</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"object"</span>,</span><br><span class="line">  <span class="attr">"properties"</span>: &#123;</span><br><span class="line">    <span class="attr">"dataset_name"</span>: &#123;</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"additionalProperties"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"required"</span>: [</span><br><span class="line">    <span class="string">"dataset_name"</span>,</span><br><span class="line">    <span class="string">"image_name"</span>,</span><br><span class="line">    <span class="string">"task_type"</span>,</span><br><span class="line">    <span class="string">"image_height"</span>,</span><br><span class="line">    <span class="string">"image_width"</span>,</span><br><span class="line">    <span class="string">"checkpoint_name"</span>,</span><br><span class="line">    <span class="string">"infer_results"</span>,</span><br><span class="line">    <span class="string">"gt_results"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-Python校验库推荐"><a class="header-anchor" href="#4-Python校验库推荐">¶</a>4. Python校验库推荐</h2><hr><p>为了服务于我们的算法端对推理结果数据的校验。按照和Java校验库一样的选用依据，推荐：</p><ul><li><a href="https://github.com/Julian/jsonschema" target="_blank" rel="noopener">jsonschema</a> <em>2019-09, 2020-12, draft-07, -06, -04, -03</em> (MIT License)</li></ul><blockquote><h2 id="jsonschema"><a class="header-anchor" href="#jsonschema">¶</a>jsonschema</h2><p><code>jsonschema</code> is an implementation of the <a href="https://json-schema.org/" target="_blank" rel="noopener">JSON Schema</a> specification for Python.</p><h2 id="Features"><a class="header-anchor" href="#Features">¶</a>Features</h2><ul><li><p>Partial support for <a href="https://python-jsonschema.readthedocs.io/en/latest/validate/#jsonschema.Draft202012Validator" target="_blank" rel="noopener">Draft 2020-12</a> and <a href="https://python-jsonschema.readthedocs.io/en/latest/validate/#jsonschema.Draft201909Validator" target="_blank" rel="noopener">Draft 2019-09</a>, except for <code>dynamicRef</code> / <code>recursiveRef</code> and <code>$vocabulary</code> (in-progress). Full support for <a href="https://python-jsonschema.readthedocs.io/en/latest/validate/#jsonschema.Draft7Validator" target="_blank" rel="noopener">Draft 7</a>, <a href="https://python-jsonschema.readthedocs.io/en/latest/validate/#jsonschema.Draft6Validator" target="_blank" rel="noopener">Draft 6</a>, <a href="https://python-jsonschema.readthedocs.io/en/latest/validate/#jsonschema.Draft4Validator" target="_blank" rel="noopener">Draft 4</a> and <a href="https://python-jsonschema.readthedocs.io/en/latest/validate/#jsonschema.Draft3Validator" target="_blank" rel="noopener">Draft 3</a></p></li><li><p><a href="https://python-jsonschema.readthedocs.io/en/latest/validate/#jsonschema.protocols.Validator.iter_errors" target="_blank" rel="noopener">Lazy validation</a> that can iteratively report <em>all</em> validation errors.</p></li><li><p><a href="https://python-jsonschema.readthedocs.io/en/latest/errors/" target="_blank" rel="noopener">Programmatic querying</a> of which properties or items failed validation.</p></li></ul><h2 id="Installation"><a class="header-anchor" href="#Installation">¶</a>Installation</h2><p><code>jsonschema</code> is available on <a href="https://pypi.org/project/jsonschema/" target="_blank" rel="noopener">PyPI</a>. You can install using <a href="https://pip.pypa.io/en/stable/" target="_blank" rel="noopener">pip</a>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;$ pip install jsonschema</span><br></pre></td></tr></table></figure></blockquote><p>这个组件是目前我收集并比对了一些官方推荐的所有实现里面，唯一符合我们需求的选项。</p><h2 id="5-参考链接"><a class="header-anchor" href="#5-参考链接">¶</a>5. 参考链接</h2><hr><ul><li><p><a href="https://json-schema.org/understanding-json-schema" target="_blank" rel="noopener">understanding JSON Schema</a></p></li><li><p><a href="https://json-schema.apifox.cn/" target="_blank" rel="noopener">JSON Schema 规范（中文版）</a></p></li><li><p><a href="https://json-schema.org/implementations.html#validator-java" target="_blank" rel="noopener">JSON Schema - Implementations</a></p></li><li><p><a href="https://github.com/networknt/json-schema-validator-perftest" target="_blank" rel="noopener">networknt/json-schema-validator-perftest</a></p></li><li><p><a href="https://github.com/networknt/json-schema-validator" target="_blank" rel="noopener">networknt/json-schema-validator</a></p></li><li><p><a href="https://github.com/everit-org/json-schema#example" target="_blank" rel="noopener">everit-org/json-schema</a></p></li><li><p><a href="https://github.com/java-json-tools/json-schema-validator" target="_blank" rel="noopener">fge | java-json-tools/json-schema-validator</a></p></li><li><p><a href="https://github.com/saasquatch/json-schema-inferrer" target="_blank" rel="noopener">json-schema-inferrer</a></p></li><li><p><a href="https://github.com/Julian/jsonschema#jsonschema" target="_blank" rel="noopener">Python-jsonschema-github</a></p></li><li><p><a href="https://pypi.org/project/jsonschema/" target="_blank" rel="noopener">Python-pypi-jsonschema</a></p></li><li><p><a href="https://python-jsonschema.readthedocs.io/en/stable/" target="_blank" rel="noopener">Python-jsonschema-docs</a></p></li></ul></div><div><div><br><br><div style="text-align:center;color:#ccc;font-size:14px">----------- 本文结束 -----------</div><br><br><br><br></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/JSON-Schema/" rel="tag"><i class="fa fa-tag">JSON Schema</i></a></div><div class="post-widgets"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2022/12/23/OAuth2%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%EF%BC%9AAuth%20Server&%20Client%E5%BA%8F%E5%88%97%E5%8C%96%E9%97%AE%E9%A2%98/" rel="prev" title="OAuth2问题记录：Auth Server& Client序列化问题"><i class="fa fa-chevron-left"></i> OAuth2问题记录：Auth Server& Client序列化问题</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2021/11/13/%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%EF%BC%9A%E5%A4%9A%E4%BA%8B%E5%8A%A1%E4%B9%8B%E9%97%B4%E4%BA%A7%E7%94%9F%E5%B9%BB%E8%AF%BB/" rel="next" title="项目问题记录：多事务之间产生幻读">项目问题记录：多事务之间产生幻读 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="gitment-container"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/"><img class="site-author-image" itemprop="image" src="/images/logo.jpg" alt="Jin Zombie"></a><p class="site-author-name" itemprop="name">Jin Zombie</p><p class="site-description motion-element" itemprop="description">Just code it</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/%7C%7C%20archive"><span class="site-state-item-count">14</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">9</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">27</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zombiesoull" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-history fa-" aria-hidden="true"></i> 近期文章</div><ul class="links-of-blogroll-list"><li class="recent_posts_li"><a href="/2022/12/27/OpenFeign%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5&%E4%B8%AD%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/" title="OpenFeign最佳实践&中高级用法" target="_blank">OpenFeign最佳实践&中高级用法</a></li><li class="recent_posts_li"><a href="/2022/12/23/OAuth2%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%EF%BC%9AAuth%20Server&%20Client%E5%BA%8F%E5%88%97%E5%8C%96%E9%97%AE%E9%A2%98/" title="OAuth2问题记录：Auth Server& Client序列化问题" target="_blank">OAuth2问题记录：Auth Server& Client序列化问题</a></li><li class="recent_posts_li"><a href="/2022/01/24/JSON%20Schema%E8%B0%83%E7%A0%94/" title="JSON Schema的最佳实践&高级用法" target="_blank">JSON Schema的最佳实践&高级用法</a></li><li class="recent_posts_li"><a href="/2021/11/13/%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95%EF%BC%9A%E5%A4%9A%E4%BA%8B%E5%8A%A1%E4%B9%8B%E9%97%B4%E4%BA%A7%E7%94%9F%E5%B9%BB%E8%AF%BB/" title="项目问题记录：多事务之间产生幻读" target="_blank">项目问题记录：多事务之间产生幻读</a></li><li class="recent_posts_li"><a href="/2020/11/05/Spring%E5%B5%8C%E5%A5%97%E4%BA%8B%E5%8A%A1%E5%AD%A6%E4%B9%A0/" title="Spring嵌套事务学习" target="_blank">Spring嵌套事务学习</a></li></ul></div><div class="links-of-blogroll motion-element links-of-blogroll-block"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://github.com/zombiesoull" title="zombiesoull_github" target="_blank">zombiesoull_github</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#null"><span class="nav-text">JSON Schema最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-what-is-it-？"><span class="nav-text">¶1.what is it ？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-有哪些第三方实现"><span class="nav-text">¶2. 有哪些第三方实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Java校验库选型"><span class="nav-text">¶3. Java校验库选型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-挑选出合适的实现库"><span class="nav-text">¶1. 挑选出合适的实现库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-通过编码进行性能测试"><span class="nav-text">¶2. 通过编码进行性能测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Performance"><span class="nav-text">¶Performance</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-根据测试统计信息进行选择"><span class="nav-text">¶3. 根据测试统计信息进行选择</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-安利一个根据json模板文件推理出JSON-schema的库"><span class="nav-text">¶4. 安利一个根据json模板文件推理出JSON schema的库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#（1）官方介绍"><span class="nav-text">¶（1）官方介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（2）编码实践"><span class="nav-text">¶（2）编码实践</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Python校验库推荐"><span class="nav-text">¶4. Python校验库推荐</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jsonschema"><span class="nav-text">¶jsonschema</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Features"><span class="nav-text">¶Features</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Installation"><span class="nav-text">¶Installation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-参考链接"><span class="nav-text">¶5. 参考链接</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Jin Zombie</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv">本站访问数 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 人次 </span><span class="site-pv">本站总访问量 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/clipboard.min.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/highlight-wrap.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.setAttribute("issue-term","pathname"),t.setAttribute("theme","github-light"),t.setAttribute("repo","zombiesoull/talk"),t.crossorigin="anonymous",t.src="https://utteranc.es/client.js",document.getElementById("gitment-container").appendChild(t)}()</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="search-popup-overlay local-search-pop-overlay"></div>').css("overflow","hidden"),$(".search-popup-overlay").click(onPopupClose),$(".popup").toggle();var t=$("#local-search-input");t.attr("autocapitalize","none"),t.attr("autocorrect","off"),t.focus()}var isfetched=!1,isXml=!0,search_path="search.xml";0===search_path.length?search_path="search.xml":/json$/i.test(search_path)&&(isXml=!1);var path="/"+search_path,onPopupClose=function(t){$(".popup").hide(),$("#local-search-input").val(""),$(".search-result-list").remove(),$("#no-result").remove(),$(".local-search-pop-overlay").remove(),$("body").css("overflow","")},searchFunc=function(t,e,o){"use strict";$("body").append('<div class="search-popup-overlay local-search-pop-overlay"><div id="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div>').css("overflow","hidden"),$("#search-loading-icon").css("margin","20% auto 0 auto").css("text-align","center"),$.ajax({url:t,dataType:isXml?"xml":"json",async:!0,success:function(t){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var n=isXml?$("entry",t).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get():t,r=document.getElementById(e),s=document.getElementById(o),a=function(){var t=r.value.trim().toLowerCase(),e=t.split(/[\s\-]+/);e.length>1&&e.push(t);var o=[];if(t.length>0&&n.forEach(function(n){function r(e,o,n,r){for(var s=r[r.length-1],a=s.position,i=s.word,l=[],h=0;a+i.length<=n&&0!=r.length;){i===t&&h++,l.push({position:a,length:i.length});var p=a+i.length;for(r.pop();0!=r.length&&(s=r[r.length-1],a=s.position,i=s.word,p>a);)r.pop()}return c+=h,{hits:l,start:o,end:n,searchTextCount:h}}function s(t,e){var o="",n=e.start;return e.hits.forEach(function(e){o+=t.substring(n,e.position);var r=e.position+e.length;o+='<b class="search-keyword">'+t.substring(e.position,r)+"</b>",n=r}),o+=t.substring(n,e.end)}var a=!1,i=0,c=0,l=n.title.trim(),h=l.toLowerCase(),p=n.content.trim().replace(/<[^>]+>/g,""),u=p.toLowerCase(),f=decodeURIComponent(n.url),d=[],g=[];if(""!=l&&(e.forEach(function(t){function e(t,e,o){var n=t.length;if(0===n)return[];var r=0,s=[],a=[];for(o||(e=e.toLowerCase(),t=t.toLowerCase());(s=e.indexOf(t,r))>-1;)a.push({position:s,word:t}),r=s+n;return a}d=d.concat(e(t,h,!1)),g=g.concat(e(t,u,!1))}),(d.length>0||g.length>0)&&(a=!0,i=d.length+g.length)),a){[d,g].forEach(function(t){t.sort(function(t,e){return e.position!==t.position?e.position-t.position:t.word.length-e.word.length})});var v=[];0!=d.length&&v.push(r(l,0,l.length,d));for(var $=[];0!=g.length;){var C=g[g.length-1],m=C.position,x=C.word,w=m-20,y=m+80;0>w&&(w=0),y<m+x.length&&(y=m+x.length),y>p.length&&(y=p.length),$.push(r(p,w,y,g))}$.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start});var T=parseInt("1");T>=0&&($=$.slice(0,T));var b="";b+=0!=v.length?"<li><a href='"+f+"' class='search-result-title'>"+s(l,v[0])+"</a>":"<li><a href='"+f+"' class='search-result-title'>"+l+"</a>",$.forEach(function(t){b+="<a href='"+f+'\'><p class="search-result">'+s(p,t)+"...</p></a>"}),b+="</li>",o.push({item:b,searchTextCount:c,hitCount:i,id:o.length})}}),1===e.length&&""===e[0])s.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x" /></div>';else if(0===o.length)s.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>';else{o.sort(function(t,e){return t.searchTextCount!==e.searchTextCount?e.searchTextCount-t.searchTextCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id});var a='<ul class="search-result-list">';o.forEach(function(t){a+=t.item}),a+="</ul>",s.innerHTML=a}};r.addEventListener("input",a),$(".local-search-pop-overlay").remove(),$("body").css("overflow",""),proceedsearch()}})};$(".popup-trigger").click(function(t){t.stopPropagation(),isfetched===!1?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(onPopupClose),$(".popup").click(function(t){t.stopPropagation()}),$(document).on("keyup",function(t){var e=27===t.which&&$(".search-popup").is(":visible");e&&onPopupClose()})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={},pbOptions.iconStyle="box",pbOptions.boxForm="horizontal",pbOptions.position="bottomCenter",pbOptions.networks="Weibo,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={},flOptions.iconStyle="box",flOptions.boxForm="horizontal",flOptions.position="middleRight",flOptions.networks="Weibo,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script></body></html><!-- rebuild by neat -->